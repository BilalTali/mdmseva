import{r as a,j as e}from"./app-B9edM2Qa.js";import{R as w}from"./refresh-cw-DLM6FCEo.js";import{P as k}from"./package-BLGg43bg.js";import{C as F}from"./calendar-BBr-ayVU.js";import{U as $}from"./users-B3woLVbt.js";import"./createLucideIcon-BkKsdSct.js";const B=({selectedMonth:l,selectedYear:c,schoolType:o="both",limit:v=10,showPagination:C=!0})=>{const[x,_]=a.useState([]),[R,f]=a.useState(!0),[p,g]=a.useState(null),[r,P]=a.useState(1),[d,D]=a.useState(1),[n,j]=a.useState(!1),b=o==="primary"||o==="middle",N=o==="middle",m=async(s=1)=>{try{f(s===1),j(s!==1);const t=new URLSearchParams({per_page:v,page:s});l&&t.append("month",l),c&&t.append("year",c);const i=await fetch(`/ api / dashboard / recent ? ${t} `,{headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include"});if(!i.ok)throw new Error("Failed to fetch recent consumptions");const u=await i.json();_(u.data||[]),P(u.current_page||1),D(u.last_page||1),g(null)}catch(t){console.error("Error fetching consumptions:",t),g(t.message)}finally{f(!1),j(!1)}};a.useEffect(()=>{m(1)},[l,c,v]);const S=s=>{if(!s)return"N/A";const t=new Date(s),i={day:"2-digit",month:"short",year:"numeric"};return t.toLocaleDateString("en-IN",i)},L=s=>s?new Date(s).toLocaleDateString("en-IN",{weekday:"short"}):"N/A",E=s=>(s.served_primary||0)+(s.served_middle||0),y=s=>{s>=1&&s<=d&&m(s)},h=()=>{m(r)};return R?e.jsxs("div",{className:"bg-[var(--surface-00)] rounded-lg shadow p-6 transition-colors duration-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-[var(--text-primary)]",children:"Recent Consumptions"})}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(s=>e.jsx("div",{className:"border border-[var(--border-light)] rounded-lg p-4 animate-pulse",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-[var(--surface-10)] rounded w-32 mb-2"}),e.jsx("div",{className:"h-3 bg-[var(--surface-10)] rounded w-48"})]}),e.jsx("div",{className:"h-6 bg-[var(--surface-10)] rounded w-20"})]})},s))})]}):p?e.jsxs("div",{className:"bg-[var(--surface-00)] rounded-lg shadow p-6 transition-colors duration-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-[var(--text-primary)]",children:"Recent Consumptions"})}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-[var(--color-danger)] mb-2",children:e.jsx("svg",{className:"h-12 w-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("p",{className:"text-[var(--text-secondary)] mb-4",children:p}),e.jsx("button",{onClick:h,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Try Again"})]})]}):!x||x.length===0?e.jsxs("div",{className:"bg-[var(--surface-00)] rounded-lg shadow p-6 transition-colors duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-[var(--text-primary)]",children:"Recent Consumptions"}),e.jsx("button",{onClick:h,disabled:n,className:"p-2 hover:bg-[var(--surface-10)] rounded-md transition-colors",title:"Refresh",children:e.jsx(w,{className:`h - 4 w - 4 text - gray - 600 dark: text - gray - 400 ${n?"animate-spin":""} `})})]}),e.jsxs("div",{className:"text-center py-12 bg-gray-50  rounded-lg",children:[e.jsx(k,{className:"h-12 w-12 text-[var(--text-muted)] mx-auto mb-4"}),e.jsx("p",{className:"text-[var(--text-tertiary)] font-medium mb-2",children:"No consumption records yet"}),e.jsx("p",{className:"text-sm text-[var(--text-muted)]",children:"Start adding daily consumption data to see records here"})]})]}):e.jsxs("div",{className:"bg-[var(--surface-00)] rounded-lg shadow p-6 transition-colors duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-[var(--text-primary)]",children:"Recent Consumptions"}),e.jsx("button",{onClick:h,disabled:n,className:"p-2 hover:bg-[var(--surface-10)] rounded-md transition-colors",title:"Refresh",children:e.jsx(w,{className:`h - 4 w - 4 text - gray - 600 dark: text - gray - 400 ${n?"animate-spin":""} `})})]}),e.jsx("div",{className:"space-y-3",children:x.map(s=>e.jsx("div",{className:"border border-[var(--border-light)] rounded-lg p-4 hover:border-blue-300  hover:shadow-sm transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center bg-[var(--primary-50)] rounded-lg px-3 py-2 min-w-[70px]",children:[e.jsx("span",{className:"text-xs font-medium text-blue-600  uppercase",children:s.day||L(s.date)}),e.jsx("span",{className:"text-lg font-bold text-[var(--primary-900)]",children:new Date(s.date).getDate()}),e.jsx("span",{className:"text-xs text-blue-600 ",children:new Date(s.date).toLocaleDateString("en-IN",{month:"short"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(F,{className:"h-4 w-4 text-[var(--text-muted)]"}),e.jsx("span",{className:"text-sm font-medium text-[var(--text-primary)]",children:S(s.date)})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-[var(--text-secondary)]",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{className:"h-4 w-4 text-[var(--text-muted)]"}),e.jsxs("span",{children:[E(s)," students"]}),b&&N&&s.served_primary>0&&s.served_middle>0&&e.jsxs("span",{className:"text-xs text-[var(--text-muted)] ml-1",children:["(P: ",s.served_primary,", M: ",s.served_middle,")"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"h-4 w-4 text-[var(--text-muted)]"}),e.jsxs("span",{children:[s.rice_consumed," kg rice"]})]})]}),s.remarks&&e.jsx("p",{className:"text-xs text-[var(--text-tertiary)] mt-2 italic",children:s.remarks})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("span",{className:"text-lg font-bold text-[var(--text-primary)]",children:["₹",parseFloat(s.amount_consumed).toFixed(2)]}),e.jsx("span",{className:"text-xs text-[var(--text-tertiary)]",children:"Total spent"}),b&&N&&s.served_primary>0&&s.served_middle>0&&e.jsxs("div",{className:"text-xs text-[var(--text-muted)] mt-1",children:[e.jsxs("div",{children:["P: ₹",(s.served_primary*.1*5).toFixed(0)]}),e.jsxs("div",{children:["M: ₹",(s.served_middle*.15*5).toFixed(0)]})]})]})]})},s.id))}),C&&d>1&&e.jsxs("div",{className:"mt-6 flex items-center justify-between border-t border-[var(--border-light)] pt-4",children:[e.jsxs("div",{className:"text-sm text-[var(--text-secondary)]",children:["Page ",r," of ",d]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>y(r-1),disabled:r===1,className:`px - 3 py - 2 rounded - md text - sm font - medium transition - colors ${r===1?"bg-gray-100 dark:bg-gray-900 text-gray-400 dark:text-gray-600 cursor-not-allowed":"bg-[var(--surface-00)] border border-[var(--border-light)] text-[var(--text-secondary)] hover:bg-[var(--surface-10)]"} `,children:"Previous"}),e.jsx("button",{onClick:()=>y(r+1),disabled:r===d,className:`px - 3 py - 2 rounded - md text - sm font - medium transition - colors ${r===d?"bg-gray-100 dark:bg-gray-900 text-gray-400 dark:text-gray-600 cursor-not-allowed":"bg-[var(--surface-00)] border border-[var(--border-light)] text-[var(--text-secondary)] hover:bg-[var(--surface-10)]"} `,children:"Next"})]})]})]})};export{B as default};
