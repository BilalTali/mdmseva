import{r as o,b as d,j as a,H as Q,L as j,a as U}from"./app-D5PU4Bsy.js";import{A as X}from"./AuthenticatedLayout-D5Ymgcdy.js";import Z from"./DashboardWidget-BSoFLaws.js";import{c as ee}from"./createLucideIcon-CfSDZJ_3.js";import{R as w}from"./refresh-cw-SmGULV5X.js";import"./transition-D0ghav8l.js";import"./AuthLogo-E-8NJw9p.js";import"./SupportChatWidget-BWCam85T.js";import"./StatCard-D9GLjdF_.js";import"./card-DLOtA5Pc.js";import"./package-B2jZAmzg.js";import"./trending-down-rJMRAr2o.js";import"./dollar-sign-BhBm0tav.js";import"./users-DqIoHiVC.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],te=ee("funnel",ae),be=({auth:N,initialSummary:_,currentYear:c,currentMonth:D,schoolType:A,monthlyReportStatus:u={}})=>{const[m,S]=o.useState(_||{}),[i,h]=o.useState(!1),[l,R]=o.useState(D),[n,M]=o.useState(c),[k,C]=o.useState(!1),[L,B]=o.useState([]),[I,E]=o.useState({}),[F,T]=o.useState([]),[H,J]=o.useState([]),[O,P]=o.useState([]),f=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],V=Array.from({length:6},(e,t)=>c-t),b=o.useCallback(async()=>{h(!0);try{const e=await d.get("/api/dashboard/summary",{params:{year:n,month:l},timeout:8e3});if(e.data){const t=e.data.success?e.data.data:e.data;t&&typeof t=="object"&&S({rice_available:t.rice_available||0,rice_consumed:t.rice_consumed||0,amount_spent:t.amount_spent||0,students_served:t.students_served||0,days_served:t.days_served||0,total_students:t.total_students||0,student_serving_target:t.student_serving_target||t.total_students||0,closing_balance:t.closing_balance||0})}h(!1),setTimeout(()=>{q()},100)}catch(e){console.error("Error fetching dashboard data:",e),h(!1)}},[n,l]),q=o.useCallback(async()=>{try{const[e,t,y,g,v]=await Promise.allSettled([d.get("/api/dashboard/rice-balance-timeseries",{params:{year:n,month:l},timeout:8e3}),d.get("/api/dashboard/amount-breakdown",{params:{year:n,month:l},timeout:8e3}),d.get("/api/dashboard/daily-amount-chart",{params:{year:n,month:l},timeout:8e3}),d.get("/api/dashboard/monthly-trends",{params:{year:n,month:l},timeout:8e3}),d.get("/api/dashboard/student-attendance",{params:{year:n,month:l},timeout:8e3})]);if(e.status==="fulfilled"){const s=e.value.data,r=s.success?s.data:s;Array.isArray(r)&&B(r)}if(t.status==="fulfilled"){const s=t.value.data,r=s.success?s.data:s;r&&typeof r=="object"&&!Array.isArray(r)&&E(r)}if(y.status==="fulfilled"){const s=y.value.data,r=s.success?s.data:s;Array.isArray(r)&&T(r)}if(g.status==="fulfilled"){const s=g.value.data,r=s.success?s.data:s;Array.isArray(r)&&J(r)}if(v.status==="fulfilled"){const s=v.value.data,r=s.success?s.data:s;Array.isArray(r)&&P(r)}C(!0)}catch(e){console.error("Error fetching chart data:",e)}},[n,l]);o.useEffect(()=>{b()},[b]);const p=(e,t)=>{U.get(route("dashboard"),{month:e,year:t},{preserveState:!0,preserveScroll:!0})},z=e=>{const t=parseInt(e.target.value);R(t),p(t,n)},W=e=>{const t=parseInt(e.target.value);M(t),p(l,t)},Y=()=>{p(l,n)},x=m.student_serving_target||0,$=x>0?Math.min(100,Math.round(m.students_served/x*100)):0,G=e=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(e),K=(e,t)=>!u||!u[e]?{}:u[e][t]||{};return a.jsxs(X,{user:N.user,header:null,children:[a.jsx(Q,{title:"Dashboard"}),a.jsx("div",{className:"py-6",children:a.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[a.jsx("div",{className:"mb-6 flex justify-end",children:a.jsxs("div",{className:"flex items-center gap-3 bg-white p-2 rounded-lg shadow-sm border border-gray-200",children:[a.jsxs("div",{className:"flex items-center gap-2 bg-[var(--surface-00)] border border-[var(--border-light)] rounded-lg px-3 py-2",children:[a.jsx(te,{className:"w-4 h-4 text-[var(--text-tertiary)]"}),a.jsx("select",{value:l,onChange:z,className:"border-0 bg-transparent text-sm font-medium text-[var(--text-secondary)] focus:outline-none focus:ring-0 cursor-pointer",disabled:i,children:f.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))}),a.jsx("select",{value:n,onChange:W,className:"border-0 bg-transparent text-sm font-medium text-[var(--text-secondary)] focus:outline-none focus:ring-0 cursor-pointer",disabled:i,children:V.map(e=>a.jsx("option",{value:e,children:e},e))})]}),a.jsxs("button",{onClick:Y,disabled:i,className:"inline-flex items-center justify-center px-4 py-2 bg-[var(--primary-600)] text-white font-medium rounded-lg hover:bg-[var(--primary-700)] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm hover:shadow",children:[a.jsx(w,{className:`w-4 h-4 mr-2 ${i?"animate-spin":""}`}),"Refresh"]})]})}),i&&a.jsxs("div",{className:"mb-6 bg-[var(--info-50)] border border-[var(--color-info)] text-[var(--color-info)] px-4 py-3 rounded-lg flex items-center",children:[a.jsx(w,{className:"w-4 h-4 mr-2 animate-spin"}),a.jsx("span",{className:"text-sm font-medium",children:"Loading dashboard data..."})]}),a.jsx(Z,{stats:m,loading:i,showCharts:k,riceBalanceData:L,amountBreakdownData:I,dailyAmountData:F,monthlyTrendsData:H,studentAttendanceData:O,schoolType:A,formatCurrency:G,studentsPercentage:$,studentTarget:x}),a.jsx("div",{className:"mt-8 bg-white overflow-hidden shadow-sm sm:rounded-lg",children:a.jsxs("div",{className:"p-6 bg-white border-b border-gray-200",children:[a.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Monthly Report Status (",n,")"]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Month"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rice Report"}),a.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount Report"})]})}),a.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map(e=>{const t=K(n,e.value);return a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.label}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:t.has_rice_report?a.jsx(j,{href:route("rice-reports.index",{month:e.value,year:c}),className:"text-blue-600 hover:text-blue-900 hover:underline",children:"View Report"}):a.jsx("span",{className:"text-gray-400",children:"Not generated"})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:t.has_amount_report?a.jsx(j,{href:route("amount-reports.index",{month:e.value,year:c}),className:"text-blue-600 hover:text-blue-900 hover:underline",children:"View Report"}):a.jsx("span",{className:"text-gray-400",children:"Not generated"})})]},e.value)})})]})})]})})]})})]})};export{be as default};
