import{r as n,j as e}from"./app-DU62Dllk.js";import{C as v}from"./circle-alert-CAq4rKXN.js";import{R as j}from"./refresh-cw-DEgCbO9p.js";import{A as b}from"./activity-HgYGlGT3.js";import{P as N}from"./package-DbnEUSte.js";import{U as y}from"./users-But8p7Sa.js";import{C as S}from"./clock-Do7lEUEI.js";import{T as E}from"./trash-2-C2wf9mg9.js";import{S as F}from"./square-pen-BOdgLDbO.js";import{P}from"./plus-BI8SMFDg.js";import"./createLucideIcon-DekEAJNH.js";const B=({userId:w,limit:c=5,autoRefresh:d=!1,refreshInterval:x=30})=>{const[i,k]=n.useState([]),[_,u]=n.useState(!0),[h,f]=n.useState(null),[l,p]=n.useState(!1),o=async(s=!1)=>{try{u(!s),p(s);const t=await fetch(`/ api / dashboard / activity ? limit = ${c} `,{headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include"});if(!t.ok)throw new Error("Failed to fetch activities");const g=await t.json();k(g||[]),f(null)}catch(t){console.error("Error fetching activities:",t),f(t.message)}finally{u(!1),p(!1)}};n.useEffect(()=>{o(!1)},[w,c]),n.useEffect(()=>{if(!d)return;const s=setInterval(()=>{o(!0)},x*1e3);return()=>clearInterval(s)},[d,x]);const m=()=>{o(!0)},A=s=>{switch(s){case"consumption_added":return e.jsx(P,{className:"h-4 w-4"});case"consumption_edited":return e.jsx(F,{className:"h-4 w-4"});case"consumption_deleted":return e.jsx(E,{className:"h-4 w-4"});case"rice_lifted":return e.jsx(N,{className:"h-4 w-4"});case"students_updated":return e.jsx(y,{className:"h-4 w-4"});case"threshold_alert":return e.jsx(v,{className:"h-4 w-4"});default:return e.jsx(b,{className:"h-4 w-4"})}},C=s=>{switch(s){case"consumption_added":return"bg-green-100 text-green-600 dark:bg-green-900/30 ";case"consumption_edited":return"bg-blue-100 text-blue-600  ";case"consumption_deleted":return"bg-red-100 text-red-600 dark:bg-red-900/30 ";case"rice_lifted":return"bg-purple-100 text-purple-600 dark:bg-purple-900/30 ";case"students_updated":return"bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400";case"threshold_alert":return"bg-yellow-100 text-yellow-600 dark:bg-yellow-900/30 dark:text-yellow-400";default:return"bg-gray-100 text-gray-600 dark:bg-gray-700 "}},$=s=>{const t=new Date(s),a=Math.floor((new Date-t)/1e3);if(a<60)return"Just now";if(a<3600){const r=Math.floor(a/60);return`${r} ${r===1?"minute":"minutes"} ago`}else if(a<86400){const r=Math.floor(a/3600);return`${r} ${r===1?"hour":"hours"} ago`}else if(a<604800){const r=Math.floor(a/86400);return`${r} ${r===1?"day":"days"} ago`}else return t.toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})};return _?e.jsxs("div",{className:"bg-[var(--surface-00)] rounded-lg shadow p-6 transition-colors duration-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-[var(--text-primary)]",children:"Activity Feed"})}),e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsxs("div",{className:"flex gap-3 animate-pulse",children:[e.jsx("div",{className:"h-8 w-8 bg-[var(--surface-10)] rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-[var(--surface-10)] rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-3 bg-[var(--surface-10)] rounded w-1/2"})]})]},s))})]}):h?e.jsxs("div",{className:"bg-[var(--surface-00)] rounded-lg shadow p-6 transition-colors duration-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h3",{className:"text-lg font-semibold text-[var(--text-primary)]",children:"Activity Feed"})}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx(v,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-[var(--text-secondary)] mb-4",children:h}),e.jsx("button",{onClick:m,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Try Again"})]})]}):!i||i.length===0?e.jsxs("div",{className:"bg-[var(--surface-00)] rounded-lg shadow p-6 transition-colors duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-[var(--text-primary)]",children:"Activity Feed"}),e.jsx("button",{onClick:m,disabled:l,className:"p-2 hover:bg-[var(--surface-10)] rounded-md transition-colors",title:"Refresh",children:e.jsx(j,{className:`h - 4 w - 4 text - gray - 600 dark: text - gray - 400 ${l?"animate-spin":""} `})})]}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx(b,{className:"h-12 w-12 text-gray-400 dark:text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-[var(--text-tertiary)] font-medium mb-2",children:"No recent activity"}),e.jsx("p",{className:"text-sm text-[var(--text-muted)]",children:"Activities will appear here as you use the system"})]})]}):e.jsxs("div",{className:"bg-[var(--surface-00)] rounded-lg shadow p-6 transition-colors duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-[var(--text-primary)]",children:"Activity Feed"}),d&&e.jsx("span",{className:"text-xs text-[var(--text-tertiary)] bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded",children:"Auto-refresh"})]}),e.jsx("button",{onClick:m,disabled:l,className:"p-2 hover:bg-[var(--surface-10)] rounded-md transition-colors",title:"Refresh",children:e.jsx(j,{className:`h - 4 w - 4 text - gray - 600 dark: text - gray - 400 ${l?"animate-spin":""} `})})]}),e.jsx("div",{className:"space-y-4",children:i.map((s,t)=>e.jsxs("div",{className:"flex gap-3 group hover:bg-[var(--surface-10)]/50 -mx-3 px-3 py-2 rounded-lg transition-colors",children:[e.jsx("div",{className:`
                            flex items - center justify - center h - 8 w - 8 rounded - full flex - shrink - 0
                            ${C(s.type)}
`,children:A(s.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-200 font-medium",children:s.description}),s.data&&e.jsxs("div",{className:"mt-1 flex flex-wrap gap-3 text-xs text-[var(--text-tertiary)]",children:[s.data.rice_consumed&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(N,{className:"h-3 w-3"}),s.data.rice_consumed," kg rice"]}),s.data.students_served&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"h-3 w-3"}),s.data.students_served," students"]}),s.data.served_primary>0&&e.jsxs("span",{className:"text-[var(--text-muted)]",children:["(P: ",s.data.served_primary,", M: ",s.data.served_middle||0,")"]})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs text-[var(--text-muted)]",children:[e.jsx(S,{className:"h-3 w-3"}),e.jsx("span",{children:$(s.timestamp)})]})]})]},t))}),i.length>=c&&e.jsx("div",{className:"mt-4 pt-4 border-t border-[var(--border-light)]",children:e.jsx("button",{className:"text-sm text-[var(--color-info)] hover:text-blue-700 dark:hover:text-blue-300 font-medium w-full text-center",children:"View all activities â†’"})})]})};export{B as default};
