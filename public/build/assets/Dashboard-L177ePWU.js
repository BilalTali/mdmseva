const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChartCard-BIgSo1eE.js","assets/app-DHCAgeO8.js","assets/app-cSrDJaoP.css","assets/card-CU-RSoNk.js","assets/chart-column-CBUKGc-4.js","assets/createLucideIcon-DQAdNBRm.js","assets/circle-alert-CTSCcRL4.js","assets/RiceBalanceChart-DyTeNSHC.js","assets/ThemeContext-EnF1JpCF.js","assets/CategoricalChart-B_DM5-VD.js","assets/clsx-B-dksMZM.js","assets/index-Ba4gUWok.js","assets/with-selector-ClQDlPES.js","assets/AreaChart-Bfi5mQLk.js","assets/ActivePoints-CV4672Dv.js","assets/ReactUtils-CHPHKHfT.js","assets/CartesianChart-DWSN_jJT.js","assets/getRadiusAndStrokeWidthFromDot-CJLef0io.js","assets/LineChart-kBUcZiSg.js","assets/ErrorBarContext-AjH_zAA5.js","assets/Legend-NZY6pfzZ.js","assets/AmountBreakdownChart-Bo8Ykzeu.js","assets/PolarChart-Bcs1AVNG.js","assets/tooltipContext-D5fRwJRy.js","assets/DailyAmountChart-BKHneoca.js","assets/BarChart-BtxVG7T5.js","assets/MonthlyTrendsChart-C3HOQMVX.js","assets/StudentAttendanceChart-TskTDnUu.js"])))=>i.map(i=>d[i]);
import{r,b as h,j as e,H as oe,R as u,L as j,_ as p,a as de}from"./app-DHCAgeO8.js";import{f as N,e as P,A as ce}from"./AuthenticatedLayout-dBQysIGU.js";import _ from"./StatCard-Ce6-1KQE.js";import{s as I,D as me,C as ue,F as he}from"./startOfMonth-Br8VP5U2.js";import{R as V}from"./refresh-cw-CDdiVQQp.js";import{P as pe}from"./package-DRaxT-da.js";import{T as F}from"./trending-down-CeSOmO-w.js";import{U as xe}from"./users-B-4uzz7n.js";import{C as w}from"./chart-column-CBUKGc-4.js";import"./ApplicationLogo-Da_2dMoK.js";import"./transition-jgp50ovQ.js";import"./createLucideIcon-DQAdNBRm.js";import"./send-BtT_p_gw.js";import"./card-CU-RSoNk.js";import"./arrow-up-right-C-RfYmSH.js";const f=u.lazy(()=>p(()=>import("./ChartCard-BIgSo1eE.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),ye=u.lazy(()=>p(()=>import("./RiceBalanceChart-DyTeNSHC.js"),__vite__mapDeps([7,1,2,8,9,10,11,12,13,14,15,16,17,18,19,20]))),ge=u.lazy(()=>p(()=>import("./AmountBreakdownChart-Bo8Ykzeu.js"),__vite__mapDeps([21,1,2,8,9,10,11,12,22,23,15]))),ve=u.lazy(()=>p(()=>import("./DailyAmountChart-BKHneoca.js"),__vite__mapDeps([24,1,2,8,9,10,11,12,25,23,15,19,16,20]))),be=u.lazy(()=>p(()=>import("./MonthlyTrendsChart-C3HOQMVX.js"),__vite__mapDeps([26,1,2,9,10,11,12,18,14,15,19,16,17,20]))),fe=u.lazy(()=>p(()=>import("./StudentAttendanceChart-TskTDnUu.js"),__vite__mapDeps([27,1,2,9,10,11,12,13,14,15,16,17,20]))),Oe=({auth:$,initialSummary:J,currentYear:o,currentMonth:D,schoolType:S,monthlyReportStatus:A={}})=>{const[m,U]=r.useState(J||{}),[d,M]=r.useState(!1),[l,H]=r.useState(D),[i,K]=r.useState(o),[je,W]=r.useState({start:N(I(new Date(o,D-1,1)),"yyyy-MM-dd"),end:N(P(new Date(o,D-1,1)),"yyyy-MM-dd")}),[k,L]=r.useState(!1),[x,q]=r.useState([]),[y,G]=r.useState({}),[g,Q]=r.useState([]),[v,X]=r.useState([]),[b,Z]=r.useState([]),E=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],Y=Array.from({length:6},(t,a)=>o-a),ee=r.useMemo(()=>new Date().toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),[]),T=r.useCallback(async()=>{M(!0);try{const t=await h.get("/api/dashboard/summary",{params:{year:i,month:l},timeout:8e3});if(t.data){const a=t.data.success?t.data.data:t.data;a&&typeof a=="object"&&U({rice_available:a.rice_available||0,rice_consumed:a.rice_consumed||0,amount_spent:a.amount_spent||0,students_served:a.students_served||0,days_served:a.days_served||0,total_students:a.total_students||0,student_serving_target:a.student_serving_target||a.total_students||0})}M(!1),setTimeout(()=>{te()},100)}catch(t){console.error("Error fetching dashboard data:",t),M(!1)}},[i,l]),te=r.useCallback(async()=>{try{const[t,a,c,z,O]=await Promise.allSettled([h.get("/api/dashboard/rice-balance-timeseries",{params:{year:i,month:l},timeout:8e3}),h.get("/api/dashboard/amount-breakdown",{params:{year:i,month:l},timeout:8e3}),h.get("/api/dashboard/daily-amount-chart",{params:{year:i,month:l},timeout:8e3}),h.get("/api/dashboard/monthly-trends",{params:{year:i,month:l},timeout:8e3}),h.get("/api/dashboard/student-attendance",{params:{year:i,month:l},timeout:8e3})]);if(t.status==="fulfilled"){const s=t.value.data,n=s.success?s.data:s;Array.isArray(n)&&q(n)}if(a.status==="fulfilled"){const s=a.value.data,n=s.success?s.data:s;n&&typeof n=="object"&&!Array.isArray(n)&&G(n)}if(c.status==="fulfilled"){const s=c.value.data,n=s.success?s.data:s;Array.isArray(n)&&Q(n)}if(z.status==="fulfilled"){const s=z.value.data,n=s.success?s.data:s;Array.isArray(n)&&X(n)}if(O.status==="fulfilled"){const s=O.value.data,n=s.success?s.data:s;Array.isArray(n)&&Z(n)}L(!0)}catch(t){console.error("Error fetching chart data:",t)}},[i,l]),B=r.useMemo(()=>{const t=new Date(i,l-1,1),a=N(I(t),"yyyy-MM-dd"),c=N(P(t),"yyyy-MM-dd");return{start:a,end:c}},[l,i]);r.useEffect(()=>{W(B)},[B]),r.useEffect(()=>{T()},[T]);const R=(t,a)=>{de.get(route("dashboard"),{month:t,year:a},{preserveState:!0,preserveScroll:!0})},ae=t=>{const a=parseInt(t.target.value);H(a),R(a,i)},se=t=>{const a=parseInt(t.target.value);K(a),R(l,a)},re=()=>{R(l,i)},C=m.student_serving_target||0,ne=C>0?Math.min(100,Math.round(m.students_served/C*100)):0,le=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(t),ie=(t,a)=>!A||!A[t]?{}:A[t][a]||{};return e.jsxs(ce,{user:$.user,header:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-[var(--text-primary)]",children:"Dashboard"}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)] mt-1",children:ee})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-[var(--surface-00)] border border-[var(--border-light)] rounded-lg px-3 py-2",children:[e.jsx(he,{className:"w-4 h-4 text-[var(--text-tertiary)]"}),e.jsx("select",{value:l,onChange:ae,className:"border-0 bg-transparent text-sm font-medium text-[var(--text-secondary)] focus:outline-none focus:ring-0 cursor-pointer",disabled:d,children:E.map(t=>e.jsx("option",{value:t.value,className:"",children:t.label},t.value))}),e.jsx("select",{value:i,onChange:se,className:"border-0 bg-transparent text-sm font-medium text-[var(--text-secondary)] focus:outline-none focus:ring-0 cursor-pointer",disabled:d,children:Y.map(t=>e.jsx("option",{value:t,className:"",children:t},t))})]}),e.jsxs("button",{onClick:re,disabled:d,className:"inline-flex items-center justify-center px-4 py-2 bg-[var(--primary-600)] text-white font-medium rounded-lg hover:bg-[var(--primary-700)] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500  disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm hover:shadow",children:[e.jsx(V,{className:`w-4 h-4 mr-2 ${d?"animate-spin":""}`}),"Refresh"]})]})]}),children:[e.jsx(oe,{title:"Dashboard"}),e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[d&&e.jsxs("div",{className:"mb-6 bg-[var(--info-50)] border border-[var(--color-info)] text-[var(--color-info)] px-4 py-3 rounded-lg flex items-center",children:[e.jsx(V,{className:"w-4 h-4 mr-2 animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading dashboard data..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(_,{title:"Rice Available",value:`${(m.rice_available||0).toLocaleString()} kg`,subtitle:"Current Stock",icon:pe,variant:"primary",loading:d}),e.jsx(_,{title:"Monthly Consumption",value:`${(m.rice_consumed||0).toLocaleString()} kg`,subtitle:`${m.days_served||0} days served`,icon:F,variant:"warning",loading:d}),e.jsx(_,{title:"Monthly Spending",value:le(m.amount_spent||0).replace("₹","₹"),subtitle:"This Month",icon:me,variant:"success",loading:d}),e.jsx(_,{title:"Students Served",value:(m.students_served||0).toLocaleString(),subtitle:`${ne}% of ${(C||m.total_students||0).toLocaleString()} target`,icon:xe,variant:"info",loading:d})]}),k&&e.jsxs(u.Suspense,{fallback:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[1,2].map(t=>e.jsx("div",{className:"bg-[var(--surface-00)] rounded-lg shadow p-6 h-80",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-[var(--surface-10)] rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-64 bg-[var(--surface-10)] rounded"})]})},t))}),children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(f,{title:"Rice Balance Trend",subtitle:"Last 30 Days",icon:w,isEmpty:!x||x.length===0,emptyMessage:"No rice balance data available",height:"h-80",children:x&&x.length>0&&e.jsx(ye,{data:x,schoolType:S})}),e.jsx(f,{title:"Amount Breakdown",subtitle:"This Month",icon:ue,isEmpty:!y||Object.keys(y).length===0,emptyMessage:"No amount breakdown data available",height:"h-80",children:y&&Object.keys(y).length>0&&e.jsx(ge,{data:y,isDonut:!0})})]}),e.jsx("div",{className:"mb-8",children:e.jsx(f,{title:"Daily Spending",subtitle:"Last 30 Days",icon:w,isEmpty:!g||g.length===0,emptyMessage:"No daily spending data available",height:"h-80",children:g&&g.length>0&&e.jsx(ve,{data:g,schoolType:S})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsx(f,{title:"Weekly Trends",subtitle:"Current Month",icon:F,isEmpty:!v||v.length===0,emptyMessage:"No monthly trends data available",height:"h-80",children:v&&v.length>0&&e.jsx(be,{data:v})}),e.jsx(f,{title:"Student Attendance",subtitle:"This Month",icon:w,isEmpty:!b||b.length===0,emptyMessage:"No attendance data available",height:"h-80",children:b&&b.length>0&&e.jsx(fe,{data:b,schoolType:S})})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg mb-8",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Monthly Reports"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"S.No"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Month"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rice Report"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount Report"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kiryana Bill"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fuel Bill"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:E.map((t,a)=>{const c=ie(o,t.value);return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a+1}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.label}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:c.has_rice_report?e.jsx(j,{href:route("rice-reports.index",{month:t.value,year:o}),className:"text-blue-600 hover:text-blue-900 hover:underline",children:"View Report"}):e.jsx("span",{className:"text-gray-400",children:"Not generated"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:c.has_amount_report?e.jsx(j,{href:route("amount-reports.index",{month:t.value,year:o}),className:"text-blue-600 hover:text-blue-900 hover:underline",children:"View Report"}):e.jsx("span",{className:"text-gray-400",children:"Not generated"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:c.has_kiryana_bill?e.jsx(j,{href:route("amount-reports.index",{month:t.value,year:o}),className:"text-blue-600 hover:text-blue-900 hover:underline",children:"View Bills"}):e.jsx("span",{className:"text-gray-400",children:"Not generated"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:c.has_fuel_bill?e.jsx(j,{href:route("amount-reports.index",{month:t.value,year:o}),className:"text-blue-600 hover:text-blue-900 hover:underline",children:"View Bills"}):e.jsx("span",{className:"text-gray-400",children:"Not generated"})})]},t.value)})})]})})]})]}),!k&&e.jsx("div",{className:"text-center mb-8",children:e.jsxs("button",{onClick:()=>L(!0),className:"inline-flex items-center px-6 py-3 bg-primary-600 text-white font-medium rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(w,{className:"w-5 h-5 mr-2"}),"Load Charts"]})})]})})]})};export{Oe as default};
