import{c as _,r as o,j as e,H as $,a as q}from"./app-B9edM2Qa.js";import{A as I}from"./AuthenticatedLayout-P_Kojleq.js";import{P}from"./package-BLGg43bg.js";import{c as k}from"./createLucideIcon-BkKsdSct.js";import{C as m}from"./circle-alert-C80AiKBf.js";import{C as N}from"./circle-check-B5QiFYcD.js";import{C as D}from"./calendar-BBr-ayVU.js";import"./transition-DO8YY8hp.js";import"./AuthLogo-CGgWzjxn.js";import"./SupportChatWidget-BeZgyYS4.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 18v-2",key:"qcmpov"}],["path",{d:"M12 18v-4",key:"q1q25u"}],["path",{d:"M16 18v-6",key:"15y0np"}]],v=k("file-chart-column-increasing",Y);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],w=k("info",F);function W({currentMonth:C,currentYear:x,availableMonths:h,schoolType:L,currentAvailableStock:R,hasRiceConfig:d}){const{props:u}=_(),a=u.flash||{},c=u.errors||{},[r,g]=o.useState({month:C,year:x}),[n,p]=o.useState(!1),[l,i]=o.useState(null),[f,b]=o.useState(!1),j=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],S=Array.from({length:10},(s,t)=>x-5+t),A=async()=>{p(!0),i(null);try{const t=await(await fetch(`/rice-reports/find-report?month=${r.month}&year=${r.year}`)).json();t.exists&&i(t)}catch(s){console.error("Error checking report:",s)}finally{p(!1)}},M=s=>{s.preventDefault(),b(!0),q.post("/rice-reports",r,{onFinish:()=>b(!1)})},y=(s,t)=>{g(G=>({...G,[s]:parseInt(t)})),i(null)},E=(s,t)=>{g({month:s,year:t}),i(null)};return e.jsxs(I,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Generate Rice Report"}),children:[e.jsx($,{title:"Generate Rice Report"}),e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-3xl mx-auto sm:px-6 lg:px-8 space-y-6",children:[d&&e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-5 shadow-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 p-3 bg-green-100 rounded-lg",children:e.jsx(P,{className:"w-7 h-7 text-green-600"})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-green-900",children:"Current Available Stock"}),e.jsxs("p",{className:"mt-1 text-3xl font-bold text-green-700",children:[R," kg"]}),e.jsx("p",{className:"mt-1 text-xs text-green-600",children:"Live data from RiceConfiguration (Primary + Upper Primary closing balances)"})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("div",{className:"inline-flex items-center px-3 py-1 bg-green-100 rounded-full",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"}),e.jsx("span",{className:"text-xs font-medium text-green-700",children:"Live"})]})})]})}),h.length>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-5 shadow-sm",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(w,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-900 mb-3",children:"Available Months for Report Generation"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:h.map(s=>e.jsx("button",{onClick:()=>E(s.month,s.year),className:`px-4 py-2 rounded-md text-sm font-medium transition-all ${r.month===s.month&&r.year===s.year?"bg-blue-600 text-white shadow-md":"bg-white text-blue-700 border border-blue-300 hover:bg-blue-50 hover:border-blue-400"}`,children:s.label},`${s.year}-${s.month}`))}),e.jsx("p",{className:"mt-3 text-xs text-blue-600",children:"These months have daily consumption records available for report generation"})]})]})}),!d&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-300 rounded-lg p-5 shadow-sm",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(m,{className:"w-6 h-6 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-yellow-900",children:"Rice Configuration Required"}),e.jsx("p",{className:"mt-2 text-sm text-yellow-700",children:"You need to set up your rice configuration before generating reports. This includes opening balance, rice lifted, and consumption rates."}),e.jsx("a",{href:"/rice-configuration/edit",className:"mt-3 inline-flex items-center px-4 py-2 bg-yellow-600 text-white text-sm font-medium rounded-md hover:bg-yellow-700 transition-colors",children:"Configure Rice Settings →"})]})]})}),(a.error||a.success||Object.keys(c).length>0)&&e.jsxs("div",{className:"space-y-3",children:[a.error&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex",children:[e.jsx(m,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-red-800",children:"Unable to generate report"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:a.error})]})]}),a.success&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 flex",children:[e.jsx(N,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-semibold text-green-800",children:a.success})})]}),Object.values(c).length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-yellow-800",children:"Please fix the following:"}),e.jsx("ul",{className:"mt-2 text-sm text-yellow-700 list-disc list-inside space-y-1",children:Object.entries(c).map(([s,t])=>e.jsx("li",{children:t},s))})]})]}),e.jsx("div",{className:"bg-white shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(v,{className:"w-6 h-6 text-indigo-600 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Select Month and Year"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Choose the period for which you want to generate the report"})]})]}),e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Month ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:r.month,onChange:s=>y("month",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0,children:j.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Year ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:r.year,onChange:s=>y("year",s.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0,children:S.map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsx("div",{children:e.jsxs("button",{type:"button",onClick:A,disabled:n,className:"w-full inline-flex justify-center items-center px-4 py-3 bg-gray-100 border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:[e.jsx(D,{className:`w-4 h-4 mr-2 ${n?"animate-spin":""}`}),n?"Checking...":"Check if Report Exists"]})}),l&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(m,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-900",children:"Report Already Exists"}),e.jsxs("p",{className:"mt-1 text-sm text-yellow-700",children:["A report for ",e.jsx("strong",{children:l.month_name})," already exists. You can view or regenerate it."]}),e.jsx("div",{className:"mt-3 flex gap-2",children:e.jsx("a",{href:l.url,className:"inline-flex items-center px-3 py-1.5 bg-yellow-600 text-white text-sm font-medium rounded hover:bg-yellow-700 transition-colors",children:"View Existing Report →"})})]})]})}),!n&&l===null&&r.month&&r.year&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(N,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-green-900",children:"Ready to Generate"}),e.jsxs("p",{className:"mt-1 text-sm text-green-700",children:["No report exists for ",e.jsxs("strong",{children:[j.find(s=>s.value===r.month)?.label," ",r.year]}),". You can generate a new report now."]})]})]})}),e.jsxs("div",{className:"flex items-center justify-end gap-4 pt-4 border-t border-gray-200",children:[e.jsx("a",{href:"/rice-reports",className:"inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:f||l!==null||!d,className:"inline-flex items-center px-4 py-2 bg-indigo-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:[e.jsx(v,{className:"w-4 h-4 mr-2"}),f?"Generating...":"Generate Report"]})]})]})]})}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-5 shadow-sm",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(w,{className:"w-5 h-5 text-gray-500 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"About Report Generation"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-2",children:[e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),e.jsx("span",{children:"Reports are generated from daily consumption records for the selected month"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),e.jsx("span",{children:"Each month can only have one report (regeneration is allowed)"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),e.jsx("span",{children:"You need daily consumption data for the selected month to generate a report"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),e.jsx("span",{children:"Rice configuration must be set up before generating any reports"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),e.jsx("span",{children:"Current available stock shown above is synced with live data from RiceConfiguration"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-indigo-600 mr-2",children:"•"}),e.jsx("span",{children:"All stock values are calculated using ConsumptionCalculationService (same as Dashboard)"})]})]})]})]})}),!1]})})]})}export{W as default};
