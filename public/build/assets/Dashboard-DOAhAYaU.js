import{r as o,b as d,j as e,H as U,L as u,a as X}from"./app-DhNoL3JN.js";import{A as Z}from"./AuthenticatedLayout-D4HZ-Zjq.js";import Y from"./DashboardWidget-CxsmEDy-.js";import{R as w}from"./refresh-cw-BwPZmJKK.js";import{c as ee}from"./createLucideIcon-B4Gf14wH.js";import"./transition-Cfg9tJBG.js";import"./AuthLogo-DOO80UpC.js";import"./SupportChatWidget-C2pfx3sn.js";import"./StatCard-DnDOZ5Bc.js";import"./card-Oi3W4tSL.js";import"./package-BqBCtS4F.js";import"./trending-down-Cvh39NQf.js";import"./dollar-sign-CTWg_C12.js";import"./users-ClieAEn6.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],ae=ee("funnel",te),ye=({auth:N,initialSummary:_,currentYear:i,currentMonth:D,schoolType:A,monthlyReportStatus:m={}})=>{const[p,S]=o.useState(_||{}),[c,h]=o.useState(!1),[l,R]=o.useState(D),[n,k]=o.useState(i),[M,C]=o.useState(!1),[B,L]=o.useState([]),[F,I]=o.useState({}),[E,T]=o.useState([]),[V,H]=o.useState([]),[J,O]=o.useState([]),y=[{value:1,label:"January"},{value:2,label:"February"},{value:3,label:"March"},{value:4,label:"April"},{value:5,label:"May"},{value:6,label:"June"},{value:7,label:"July"},{value:8,label:"August"},{value:9,label:"September"},{value:10,label:"October"},{value:11,label:"November"},{value:12,label:"December"}],P=Array.from({length:6},(t,a)=>i-a),b=o.useCallback(async()=>{h(!0);try{const t=await d.get("/api/dashboard/summary",{params:{year:n,month:l},timeout:8e3});if(t.data){const a=t.data.success?t.data.data:t.data;a&&typeof a=="object"&&S({rice_available:a.rice_available||0,rice_consumed:a.rice_consumed||0,amount_spent:a.amount_spent||0,students_served:a.students_served||0,days_served:a.days_served||0,total_students:a.total_students||0,student_serving_target:a.student_serving_target||a.total_students||0,closing_balance:a.closing_balance||0})}h(!1),setTimeout(()=>{q()},100)}catch(t){console.error("Error fetching dashboard data:",t),h(!1)}},[n,l]),q=o.useCallback(async()=>{try{const[t,a,g,v,j]=await Promise.allSettled([d.get("/api/dashboard/rice-balance-timeseries",{params:{year:n,month:l},timeout:8e3}),d.get("/api/dashboard/amount-breakdown",{params:{year:n,month:l},timeout:8e3}),d.get("/api/dashboard/daily-amount-chart",{params:{year:n,month:l},timeout:8e3}),d.get("/api/dashboard/monthly-trends",{params:{year:n,month:l},timeout:8e3}),d.get("/api/dashboard/student-attendance",{params:{year:n,month:l},timeout:8e3})]);if(t.status==="fulfilled"){const s=t.value.data,r=s.success?s.data:s;Array.isArray(r)&&L(r)}if(a.status==="fulfilled"){const s=a.value.data,r=s.success?s.data:s;r&&typeof r=="object"&&!Array.isArray(r)&&I(r)}if(g.status==="fulfilled"){const s=g.value.data,r=s.success?s.data:s;Array.isArray(r)&&T(r)}if(v.status==="fulfilled"){const s=v.value.data,r=s.success?s.data:s;Array.isArray(r)&&H(r)}if(j.status==="fulfilled"){const s=j.value.data,r=s.success?s.data:s;Array.isArray(r)&&O(r)}C(!0)}catch(t){console.error("Error fetching chart data:",t)}},[n,l]);o.useEffect(()=>{b()},[b]);const x=(t,a)=>{X.get(route("dashboard"),{month:t,year:a},{preserveState:!0,preserveScroll:!0})},z=t=>{const a=parseInt(t.target.value);R(a),x(a,n)},K=t=>{const a=parseInt(t.target.value);k(a),x(l,a)},W=()=>{x(l,n)},f=p.student_serving_target||0,$=f>0?Math.min(100,Math.round(p.students_served/f*100)):0,G=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(t),Q=(t,a)=>!m||!m[t]?{}:m[t][a]||{};return e.jsxs(Z,{user:N.user,navActions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-[var(--surface-00)] border border-[var(--border-light)] rounded-lg px-3 py-2",children:[e.jsx(ae,{className:"w-4 h-4 text-[var(--text-tertiary)]"}),e.jsx("select",{value:l,onChange:z,className:"border-0 bg-transparent text-sm font-medium text-[var(--text-secondary)] focus:outline-none focus:ring-0 cursor-pointer",disabled:c,children:y.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("select",{value:n,onChange:K,className:"border-0 bg-transparent text-sm font-medium text-[var(--text-secondary)] focus:outline-none focus:ring-0 cursor-pointer",disabled:c,children:P.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("button",{onClick:W,disabled:c,className:"inline-flex items-center justify-center px-4 py-2 bg-[var(--primary-600)] text-white font-medium rounded-lg hover:bg-[var(--primary-700)] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm hover:shadow",children:[e.jsx(w,{className:`w-4 h-4 mr-2 ${c?"animate-spin":""}`}),"Refresh"]})]}),header:null,children:[e.jsx(U,{title:"Dashboard"}),e.jsx("div",{className:"py-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:[c&&e.jsxs("div",{className:"mb-6 bg-[var(--info-50)] border border-[var(--color-info)] text-[var(--color-info)] px-4 py-3 rounded-lg flex items-center",children:[e.jsx(w,{className:"w-4 h-4 mr-2 animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Loading dashboard data..."})]}),e.jsx(Y,{stats:p,loading:c,showCharts:M,riceBalanceData:B,amountBreakdownData:F,dailyAmountData:E,monthlyTrendsData:V,studentAttendanceData:J,schoolType:A,formatCurrency:G,studentsPercentage:$,studentTarget:f}),e.jsx("div",{className:"mt-8 bg-white overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6 bg-white border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Monthly Report Status (",n,")"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Month"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rice Report"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount Report"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kiryana Bills"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fuel Bills"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:y.map(t=>{const a=Q(n,t.value);return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.label}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:a.has_rice_report?e.jsx(u,{href:route("rice-reports.index",{month:t.value,year:i}),className:"text-blue-600 hover:text-blue-900 hover:underline",children:"View Report"}):e.jsx("span",{className:"text-gray-400",children:"Not generated"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:a.has_amount_report?e.jsx(u,{href:route("amount-reports.index",{month:t.value,year:i}),className:"text-blue-600 hover:text-blue-900 hover:underline",children:"View Report"}):e.jsx("span",{className:"text-gray-400",children:"Not generated"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:a.has_kiryana_bill?e.jsx(u,{href:route("amount-reports.index",{month:t.value,year:i}),className:"text-blue-600 hover:text-blue-900 hover:underline",children:"View Bills"}):e.jsx("span",{className:"text-gray-400",children:"Not generated"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:a.has_fuel_bill?e.jsx(u,{href:route("amount-reports.index",{month:t.value,year:i}),className:"text-blue-600 hover:text-blue-900 hover:underline",children:"View Bills"}):e.jsx("span",{className:"text-gray-400",children:"Not generated"})})]},t.value)})})]})})]})})]})})]})};export{ye as default};
