import{r as t,u as C,b as E,j as e,H as A,L as x}from"./app-B7rG-o2v.js";import{A as _}from"./AuthenticatedLayout-DsY28lw4.js";import{F as M}from"./ArrowLeftIcon-3R-c1AQ1.js";import{F as p}from"./ExclamationCircleIcon-Cg06xf9v.js";import"./transition-rTlxp94F.js";import"./AuthLogo-BstlY2F2.js";import"./SupportChatWidget-BH2cX72p.js";import"./createLucideIcon-htJommDS.js";function F({title:n,titleId:i,...l},c){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":i},l),n?t.createElement("title",{id:i},n):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const S=t.forwardRef(F);function L({title:n,titleId:i,...l},c){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":i},l),n?t.createElement("title",{id:i},n):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"}))}const y=t.forwardRef(L);function V({auth:n,currentMonth:i,currentYear:l,availableMonths:c,schoolType:G,hasPrimary:I,hasMiddle:P}){const{data:o,setData:f,post:w,processing:m,errors:a}=C({month:i,year:l}),[h,g]=t.useState(!1),[u,b]=t.useState(null),[s,N]=t.useState(null);t.useEffect(()=>{o.month&&o.year&&v()},[o.month,o.year]);const v=async()=>{g(!0),b(null);try{const r=await E.get(route("amount-reports.find-report"),{params:{month:o.month,year:o.year}});r.data.exists&&b(r.data.report);const d=c.find(j=>j.month===parseInt(o.month)&&j.year===parseInt(o.year));N(d)}catch(r){console.error("Error checking report:",r)}finally{g(!1)}},k=r=>{r.preventDefault(),w(route("amount-reports.store"))},R=r=>["January","February","March","April","May","June","July","August","September","October","November","December"][r-1];return e.jsxs(_,{user:n.user,children:[e.jsx(A,{title:"Generate Amount Report"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-5xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(x,{href:route("amount-reports.index"),className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Back to Reports"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Generate Amount Report"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Create a monthly consumption report with detailed salt breakdown"})]}),e.jsx("div",{className:"mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(y,{className:"h-5 w-5 text-blue-500 mr-3 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Salt Breakdown from Configuration"}),e.jsxs("p",{className:"mt-1 text-sm text-blue-700",children:["This report will use the unified salt & condiments percentages from your",e.jsx(x,{href:route("amount-config.index"),className:"font-semibold underline hover:text-blue-900 ml-1",children:"Amount Configuration"}),"(applied to both Primary and Middle). Make sure your configuration is up to date before generating the report."]})]})]})}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white shadow-sm rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Report Period"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Month"}),e.jsx("select",{value:o.month,onChange:r=>f("month",parseInt(r.target.value)),className:`block w-full rounded-md border-gray-300 shadow-sm \r
                                            focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm`,disabled:m,children:[1,2,3,4,5,6,7,8,9,10,11,12].map(r=>e.jsx("option",{value:r,children:R(r)},r))}),a.month&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.month})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Year"}),e.jsx("select",{value:o.year,onChange:r=>f("year",parseInt(r.target.value)),className:`block w-full rounded-md border-gray-300 shadow-sm \r
                                            focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm`,disabled:m,children:Array.from({length:5},(r,d)=>l-2+d).map(r=>e.jsx("option",{value:r,children:r},r))}),a.year&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:a.year})]})]}),h&&e.jsxs("div",{className:"mt-4 flex items-center p-4 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsx(y,{className:"h-5 w-5 text-blue-500 mr-3"}),e.jsx("span",{className:"text-sm text-blue-700",children:"Checking report status..."})]}),u&&e.jsx("div",{className:"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("div",{className:"flex",children:[e.jsx(p,{className:"h-5 w-5 text-yellow-500 mr-3"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Report Already Exists"}),e.jsxs("p",{className:"mt-1 text-sm text-yellow-700",children:["A report for ",u.period," already exists. You can view it or regenerate with fresh data."]}),e.jsx("div",{className:"mt-3 flex space-x-3",children:e.jsx(x,{href:route("amount-reports.view-pdf",u.id),className:"text-sm font-medium text-yellow-800 hover:text-yellow-900 underline",children:"View Existing Report"})})]})]})}),s&&!h&&e.jsx("div",{className:`mt-4 p-4 rounded-md ${s.has_report?"bg-yellow-50 border border-yellow-200":s.record_count>0?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"flex",children:[s.record_count>0?e.jsx(S,{className:`h-5 w-5 mr-3 ${s.has_report?"text-yellow-500":"text-green-500"}`}):e.jsx(p,{className:"h-5 w-5 text-red-500 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:s.period}),e.jsx("p",{className:"mt-1 text-sm",children:s.record_count>0?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:s.record_count})," consumption records found",s.has_report&&" (Report exists)"]}):"No consumption records found for this period"})]})]})})]}),a.generation&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:e.jsxs("div",{className:"flex",children:[e.jsx(p,{className:"h-5 w-5 text-red-500 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Cannot Generate Report"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:e.jsx("ul",{className:"list-disc list-inside space-y-1",children:Array.isArray(a.generation)?a.generation.map((r,d)=>e.jsx("li",{children:r},d)):e.jsx("li",{children:a.generation})})})]})]})}),e.jsx("div",{className:"bg-white shadow-sm rounded-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{href:route("amount-reports.index"),className:"text-sm text-gray-600 hover:text-gray-900",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m||h||s&&s.record_count===0,className:`inline-flex items-center px-6 py-3 bg-indigo-600 border border-transparent \r
                                        rounded-md font-semibold text-sm text-white uppercase tracking-widest \r
                                        hover:bg-indigo-700 focus:bg-indigo-700 active:bg-indigo-900 \r
                                        focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 \r
                                        transition-all ease-in-out duration-150 disabled:opacity-50 disabled:cursor-not-allowed`,children:m?"Generating...":"Generate Report"})]})})]})]})})]})}export{V as default};
